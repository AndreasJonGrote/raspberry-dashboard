var idleTimer,selectedId;function setIdleTimer(){idleTimer=window.setTimeout((function(){document.querySelector("body").classList.remove("active"),document.querySelector(".stage .current-stage-item").classList.remove("current-stage-item"),document.querySelector(".navigation .current-stage-item").classList.remove("current-stage-item"),document.querySelector(".stage .calendar").classList.add("current-stage-item"),document.querySelector(".navigation .calendar").classList.add("current-stage-item")}),15e3)}document.body.onclick=function(){clearTimeout(idleTimer),setIdleTimer()},setIdleTimer();var appOverlay=document.querySelector(".overlay");appOverlay.addEventListener("click",(function(){document.querySelector("body").classList.add("active")}));var navigation=document.querySelectorAll(".navigation ul li a");function hueChangeState(e){var t="http://192.168.178.6/api/TGeBHhCjSMPTKGCynwdFU5uMZxEVCKyxu4w5CHl9/lights/"+e;fetch(t).then((function(e){return e.json()})).then((function(r){var n=r.state.on;const c={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({on:!n})};fetch(t+"/state/",c),1==n?document.querySelector(".hue-"+e).classList.remove("active"):document.querySelector(".hue-"+e).classList.add("active")}))}Array.from(navigation).forEach((e=>{e.addEventListener("click",(function(e){return e.preventDefault(),"weather-forecast"==(selectedId=e.target.dataset.id)&&updateInterface("weather-forecast"),"calendar"==selectedId&&updateInterface("calendar"),"hue-control"==selectedId&&updateInterface("hue-control"),document.querySelector(".stage .current-stage-item").classList.remove("current-stage-item"),document.querySelector(".navigation .current-stage-item").classList.remove("current-stage-item"),document.querySelector(".stage ."+selectedId).classList.add("current-stage-item"),document.querySelector(".navigation ."+selectedId).classList.add("current-stage-item"),!1}))}));const huecontrol=document.querySelectorAll(".hue-control a");function log(e){var t=new Date,r=new Intl.DateTimeFormat("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(t);r=r+": "+e,console.log(r)}Array.from(huecontrol).forEach((e=>{e.addEventListener("click",(function(e){return e.preventDefault(),hueChangeState(selectedId=e.target.dataset.id),!1}))}));const customTimer=document.querySelector(".set-timer.custom"),customTimerMinutes=document.querySelector(".set-timer.custom .minutes input"),customTimerSeconds=document.querySelector(".set-timer.custom .seconds input"),customTimerAddMinutes=document.querySelector(".set-timer.custom .minutes .add"),customTimerSubMinutes=document.querySelector(".set-timer.custom .minutes .sub"),customTimerAddSeconds=document.querySelector(".set-timer.custom .seconds .add"),customTimerSubSeconds=document.querySelector(".set-timer.custom .seconds .sub");function updateCustomTimer(){let e=parseInt(customTimerMinutes.dataset.value),t=parseInt(customTimerSeconds.dataset.value);e*=60,t=e+t,customTimer.setAttribute("data-value",t)}function formatTime(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}customTimerAddMinutes.addEventListener("click",(function(e){e.preventDefault();let t=parseInt(customTimerMinutes.value);return t+=1,customTimerMinutes.value=t<10?"0"+t:t,customTimerMinutes.setAttribute("data-value",t),updateCustomTimer(),!1})),customTimerSubMinutes.addEventListener("click",(function(e){e.preventDefault();let t=parseInt(customTimerMinutes.value);return t-=1,t>=0&&(customTimerMinutes.value=t<10?"0"+t:t,customTimerMinutes.setAttribute("data-value",t)),updateCustomTimer(),!1})),customTimerAddSeconds.addEventListener("click",(function(e){e.preventDefault();let t=parseInt(customTimerSeconds.value);return t+=1,customTimerSeconds.value=t<10?"0"+t:t,customTimerSeconds.setAttribute("data-value",t),updateCustomTimer(),!1})),customTimerSubSeconds.addEventListener("click",(function(e){e.preventDefault();let t=parseInt(customTimerSeconds.value);return t-=1,t>=0&&(customTimerSeconds.value=t<10?"0"+t:t,customTimerSeconds.setAttribute("data-value",t)),updateCustomTimer(),!1}));const timerWrapper=document.querySelector(".header .timer"),countdownTimer=document.querySelector(".header .timer .countdown-timer"),givenTimer=document.querySelector(".header .timer .given-timer");let timerInterval;function startTimer(e){clearInterval(timerInterval);const t=Date.now(),r=t+1e3*e;updateTimer(r-t),timerInterval=setInterval((()=>{const e=r-Date.now();e<0?(clearInterval(timerInterval),fetch("ajax.php?action=buzzer-start"),timerWrapper.classList.add("expired")):updateTimer(e)}),1e3)}function updateTimer(e){const t=Math.floor(e/6e4),r=Math.floor(e%6e4/1e3);countdownTimer.textContent=`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}const setTimerButtons=document.querySelectorAll(".set-timer .button");setTimerButtons.forEach((e=>{e.addEventListener("click",(()=>{const t=e.parentNode.dataset.value;startTimer(t),timerWrapper.classList.add("active"),givenTimer.textContent="Timer: "+formatTime(t),e.parentNode.classList.contains("custom")&&fetch("ajax.php?action=save-timer&value="+t)}))}));const headerButton=document.querySelector(".header .timer .button");function updateInterface(e){fetch("ajax.php?get="+e).then((function(e){return e.text()})).then((function(t){if(document.querySelector(".sync-"+e).innerHTML=t,"hue-control"==e){var r=document.querySelectorAll(".hue-control a");Array.from(r).forEach((e=>{e.addEventListener("click",(function(e){return e.preventDefault(),hueChangeState(selectedId=e.target.dataset.id),!1}))}))}log("sync "+e)}))}headerButton.addEventListener("click",(()=>{clearInterval(timerInterval),fetch("ajax.php?action=buzzer-end"),timerWrapper.classList.remove("expired"),timerWrapper.classList.remove("active")}));const clockHours=document.querySelector(".hours"),clockMinutes=document.querySelector(".minutes"),clockSeconds=document.querySelector(".seconds"),clockDate=document.querySelector(".date");window.setInterval((function(){let e=new Date;if(clockHours.textContent=("0"+e.getHours()).substr(-2),clockMinutes.textContent=("0"+e.getMinutes()).substr(-2),clockSeconds.textContent=":"+("0"+e.getSeconds()).substr(-2),e.getHours()+e.getMinutes()+e.getSeconds()==1){let t={weekday:"long",year:"numeric",month:"2-digit",day:"2-digit"};clockDate.textContent=new Intl.DateTimeFormat("de-DE",t).format(e)}1!=e.getSeconds()||0!=e.getMinutes()&&e.getMinutes()%5!=0||(updateInterface("calendar"),updateInterface("weather"),updateInterface("hue"),updateInterface("server")),1==e.getSeconds()&&59==e.getMinutes()&&fetch("ajax.php?get=weather-datasets")}),1e3),updateInterface("server");